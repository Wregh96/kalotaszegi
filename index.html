<!DOCTYPE html>
<html lang="hu">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1" />
  <title>Kalotaszegi Régiségek</title>
  <style>
    body {
      font-family: Georgia, serif;
      background-color: #f5f0e6;
      margin: 0;
      padding: 0;
    }
    header {
      background-color: #8b5e3c;
      color: white;
      padding: 20px;
      text-align: center;
    }
    nav {
      background-color: #d2b48c;
      display: flex;
      justify-content: center;
      gap: 20px;
      padding: 10px;
    }
    nav a {
      text-decoration: none;
      color: #000;
      font-weight: bold;
      cursor: pointer;
    }
    main {
      padding: 20px;
      max-width: 900px;
      margin: auto;
    }
    section {
      display: none;
    }
    section.active {
      display: block;
    }
    textarea, input[type="text"], input[type="file"], input[type="password"] {
      width: 100%;
      padding: 8px;
      margin-bottom: 10px;
      box-sizing: border-box;
      font-size: 1em;
    }
    button {
      background-color: #8b5e3c;
      color: white;
      border: none;
      padding: 10px 15px;
      font-size: 1em;
      cursor: pointer;
      transition: background-color 0.3s ease;
    }
    button:hover {
      background-color: #6f4c2a;
    }
    .gallery {
      max-width: 100%;
      height: 300px;
      overflow: hidden;
      position: relative;
      margin-bottom: 20px;
    }
    .gallery img {
      width: 100%;
      object-fit: cover;
      height: 100%;
    }
    .product {
      border: 1px solid #aaa;
      background: white;
      padding: 10px;
      margin-bottom: 10px;
    }
    .product img {
      max-width: 100px;
      display: block;
      margin-top: 5px;
    }
    footer {
      text-align: center;
      padding: 10px;
      background: #8b5e3c;
      color: white;
      margin-top: 30px;
    }
  </style>
</head>
<body>
  <header>
    <h1>Kalotaszegi Régiségek</h1>
  </header>
  <nav>
    <a onclick="showSection('fooldal')">Főoldal</a>
    <a onclick="showSection('butorok')">Bútorok</a>
    <a onclick="showSection('ruhak')">Ruhák</a>
    <a onclick="showSection('disztargyak')">Dísztárgyak</a>
    <a onclick="showSection('egyeb')">Egyéb</a>
    <a onclick="showSection('kapcsolat')">Kapcsolat</a>
    <a onclick="showSection('admin')">Admin</a>
  </nav>
  <main>
    <section id="fooldal" class="active">
      <div class="gallery">
        <img id="mainImage" src="" alt="Főoldali kép" />
      </div>
      <p id="intro">Üdvözöljük a Kalotaszegi Régiségek weboldalán! Kézműves hagyomány, érték és történelem.</p>
    </section>

    <section id="butorok">
      <h2>Bútorok</h2>
      <div id="butorLista"></div>
    </section>

    <section id="ruhak">
      <h2>Ruhák</h2>
      <div id="ruhakLista"></div>
    </section>

    <section id="disztargyak">
      <h2>Dísztárgyak</h2>
      <div id="disztargyakLista"></div>
    </section>

    <section id="egyeb">
      <h2>Egyéb</h2>
      <div id="egyebLista"></div>
    </section>

    <section id="kapcsolat">
      <h2>Kapcsolat</h2>
      <p>Érdeklődés esetén kérjük írjon: <a href="mailto:info@kalotaszegiregisegek.hu">info@kalotaszegiregisegek.hu</a></p>
    </section>

    <section id="admin">
      <div id="loginSection">
        <h2>Admin bejelentkezés</h2>
        <input type="password" id="adminPass" placeholder="Admin jelszó" autocomplete="off" />
        <button onclick="login()">Belépés</button>
      </div>
      <div id="adminPanel" style="display:none;">
        <h2>Admin szerkesztő</h2>

        <h3>Főoldali szöveg szerkesztése</h3>
        <textarea id="introText" rows="4"></textarea>
        <button onclick="saveIntro()">Mentés</button>

        <h3>Főoldali kép feltöltése</h3>
        <input type="file" id="mainImageUpload" accept="image/*" />
        <button onclick="uploadMainImage()">Kép feltöltése</button>
        <img id="previewMainImage" src="" alt="Előnézet" style="max-width:300px; margin-top:10px;" />

        <hr />

        <h3>Új termék hozzáadása</h3>
        <select id="categorySelect">
          <option value="butorok">Bútorok</option>
          <option value="ruhak">Ruhák</option>
          <option value="disztargyak">Dísztárgyak</option>
          <option value="egyeb">Egyéb</option>
        </select>
        <input type="text" id="productCode" placeholder="Termékszám (pl. #101)" />
        <input type="text" id="productName" placeholder="Termék neve" />
        <input type="file" id="productImage" accept="image/*" />
        <button onclick="uploadProduct()">Hozzáadás</button>
      </div>
    </section>
  </main>

  <footer>&copy; 2025 Kalotaszegi Régiségek</footer>

  <script>
    const ADMIN_PASSWORD = "590678601";
    const NETLIFY_SITE_ID = "54aa93cb-eaf6-49b2-8852-cc0717597fc1";
    const NETLIFY_UPLOAD_URL = `https://api.netlify.com/api/v1/sites/${NETLIFY_SITE_ID}/media`;
    const NETLIFY_TOKEN = "nfp_bHLN4Z4PedronoivLkWDuR8Y7PLV5ygR8d8b";

    function showSection(id) {
      document.querySelectorAll("main section").forEach(s => s.classList.remove("active"));
      document.getElementById(id).classList.add("active");
    }

    function login() {
      const pw = document.getElementById("adminPass").value;
      if(pw === ADMIN_PASSWORD){
        document.getElementById("loginSection").style.display = "none";
        document.getElementById("adminPanel").style.display = "block";

        // Betöltjük a mentett szöveget, képet, termékeket
        const savedIntro = localStorage.getItem("introText");
        if(savedIntro) document.getElementById("introText").value = savedIntro;

        const savedImage = localStorage.getItem("mainImage");
        if(savedImage) document.getElementById("previewMainImage").src = savedImage;

        loadProducts("butorok");
        loadProducts("ruhak");
        loadProducts("disztargyak");
        loadProducts("egyeb");
      } else {
        alert("Hibás jelszó!");
      }
    }

    function saveIntro() {
      const txt = document.getElementById("introText").value.trim();
      if(!txt) return alert("Írj be valamit a főoldali szöveghez!");
      localStorage.setItem("introText", txt);
      document.getElementById("intro").textContent = txt;
      alert("Főoldali szöveg mentve!");
    }

    async function uploadMainImage() {
      const input = document.getElementById("mainImageUpload");
      if(!input.files.length){
        alert("Válassz ki egy képet!");
        return;
      }
      const file = input.files[0];
      try {
        const url = await uploadFileToNetlify(file);
        if(url){
          localStorage.setItem("mainImage", url);
          document.getElementById("previewMainImage").src = url;
          document.getElementById("mainImage").src = url;
          alert("Főoldali kép sikeresen feltöltve!");
        }
      } catch(e) {
        alert("Hiba a kép feltöltésekor.");
        console.error(e);
      }
    }

    async function uploadProduct() {
      const category = document.getElementById("categorySelect").value;
      const code = document.getElementById("productCode").value.trim();
      const name = document.getElementById("productName").value.trim();
      const imageInput = document.getElementById("productImage");

      if(!code || !name){
        alert("Kérlek töltsd ki a termékszámot és a nevet!");
        return;
      }

      let imageURL = "";
      if(imageInput.files.length){
        try{
          imageURL = await uploadFileToNetlify(imageInput.files[0]);
        } catch(e){
          alert("Hiba a kép feltöltésekor.");
          console.error(e);
          return;
        }
      }

      addProduct(category, code, name, imageURL);

      // Töröljük a beviteli mezőket
      document.getElementById("productCode").value = "";
      document.getElementById("productName").value = "";
      document.getElementById("productImage").value = "";
    }

    async function uploadFileToNetlify(file) {
      const formData = new FormData();
      formData.append("file", file);
      formData.append("title", file.name);

      const res = await fetch(NETLIFY_UPLOAD_URL, {
        method: "POST",
        headers: { Authorization: `Bearer ${NETLIFY_TOKEN}` },
        body: formData
      });

      if(!res.ok){
        const err = await res.text();
        throw new Error(`Netlify feltöltési hiba: ${res.status} - ${err}`);
      }

      const data = await res.json();
      return data.url || data.sha;
    }

    function addProduct(category, code, name, imageURL) {
      const listId = category + "Lista";
      const list = document.getElementById(listId);
      if(!list) return;

      const div = document.createElement("div");
      div.className = "product";
      div.innerHTML = `<strong>${code}</strong> - ${name}` + (imageURL ? `<br><img src="${imageURL}" alt="${name}">` : "");
      list.appendChild(div);

      // Mentés localStorage-ba
      const key = category + "Items";
      const items = JSON.parse(localStorage.getItem(key) || "[]");
      items.push({code, name, imageURL});
      localStorage.setItem(key, JSON.stringify(items));
    }

    function loadProducts(category) {
      const key = category + "Items";
      const items = JSON.parse(localStorage.getItem(key) || "[]");
      const listId = category + "Lista";
      const list = document.getElementById(listId);
      if(!list) return;
      list.innerHTML = "";
      items.forEach(({code, name, imageURL}) => {
        const div = document.createElement("div");
        div.className = "product";
        div.innerHTML = `<strong>${code}</strong> - ${name}` + (imageURL ? `<br><img src="${imageURL}" alt="${name}">` : "");
        list.appendChild(div);
      });
    }

    window.addEventListener("DOMContentLoaded", () => {
      // Betöltjük a mentett főoldali szöveget és képet
      const savedIntro = localStorage.getItem("introText");
      if(savedIntro){
        document.getElementById("intro").textContent = savedIntro;
      }

      const savedImage = localStorage.getItem("mainImage");
      if(savedImage){
        document.getElementById("mainImage").src = savedImage;
      }
      // Betölthetjük alapból a terméklistákat, ha akarod itt lehet:
      // loadProducts("butorok");
      // loadProducts("ruhak");
      // loadProducts("disztargyak");
      // loadProducts("egyeb");
    });
  </script>
</body>
</html>
